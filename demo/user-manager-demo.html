<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-button/paper-button.html">
<link rel="import" href="../../paper-input/paper-input.html">
<link rel="import" href="../../paper-styles/typography.html">
<link rel="import" href="../lss-user-manager.html">

<dom-module id="user-manager-demo">
    <template>
        <style>
            h1 {
                @apply --paper-font-title;
            }

            um-prop {
                display: block;
                @apply --paper-font-body1;
            }

            um-scope {
                @apply --layout-horizontal;
                @apply --layout-center;
            }

            paper-input {
                @apply --layout-flex-2;
            }

            li {
                @apply --paper-font-caption;
            }
        </style>
        <lss-user-manager id="manager" person-id="{{personId}}" last-name="{{lastName}}" fullname="{{fullname}}" first-name="{{firstName}}"
            roles="{{roles}}"></lss-user-manager>

        <h1>User Manager Actions</h1>
        <paper-button raised on-tap="logoutClicked">logout()</paper-button>
        <paper-button raised on-tap="authenticateAsync">authenticateAsync()</paper-button>
        <um-scope>
            <paper-input placeholder="Token Scopes (ex. General, Home)" value="{{claimScopes}}"> </paper-input>
            <paper-button raised on-tap="setScopes">Set Scopes</paper-button>
        </um-scope>

        <hr/>
        <h1>User Manager Properties</h1>
        <um-prop><b>fullname:</b> [[fullname]]</um-prop>
        <um-prop><b>first-name:</b> [[firstName]]</um-prop>
        <um-prop><b>last-name:</b> [[lastName]]</um-prop>
        <um-prop><b>person-id:</b> [[personId]]</um-prop>
        <um-prop><b>roles:</b> </um-prop>
        <ol>
            <template is="dom-repeat" items="[[roles]]">
                <li>[[item]]</li>
            </template>
        </ol>
    </template>
    <script>
        class UserManagerDemo extends Polymer.Element {
            static get is() {
                return 'user-manager-demo';
            }

            static get properties() {
                return {
                    roles: {
                        type: Array,
                        notify: true
                    },
                    claimScopes: {
                        type: String
                    }
                }
            }
            logoutClicked(e) {
                console.log("logout clicked");
                this.$.manager.logout();
                location.reload();
            }
            authenticateAsync(e) {
                this.$.manager.authenticateAsync().then(function (token) {
                    console.log(token);
                }).catch(function (error) {
                    console.warn(error);
                });

            }
            setScopes() {
                this.setClaimScopes(this.claimScopes || '');
            }
            setClaimScopes(claims = '') {
                if (claims.length > 0) {
                    const data = JSON.stringify(claims.split(','));
                    window.localStorage.setItem('LgClaimScopes', data);
                } else {
                    window.localStorage.removeItem('LgClaimScopes');
                }
            }
        }
        customElements.define(UserManagerDemo.is, UserManagerDemo);
    </script>
</dom-module>